<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/HoaDon.css">
    <link rel="stylesheet" href="../assets/fontawesome-free-6.0.0-web/css/all.min.css">
    <title>Document</title>
</head>
<body>
    <div class="main">
        <header class="header">
            <div class="grid">
                <div class="grid__row header-grid">
                    <div class="welcome">
                        <p class="welcome-text">Xin chào<i class="fa-solid fa-sort-down"></i></p>
                        <div class="info">
                            <ul class="info-list">
                                <li class="info-item">
                                    <a href="#" class="info-link">
                                        <i class="fa-solid fa-user "></i>Tài khoản
                                    </a>
                                </li>
                                <li class="info-item">
                                    <a href="#" class="info-link">
                                        <i class="fa-solid fa-right-from-bracket"></i>Đăng xuất
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <section class="content">
            <div class="grid">
                <div class="grid__row">
                    <div class="grid__col1">
                        <ul class="nav-list">
                            <li class="nav-item">
                                <a href="" class="nav-link">
                                    <i class="fa-solid fa-dumpster icons-nav"></i>Tổng quan
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../admin/LoaiSP.html" class="nav-link">
                                    <i class="fa-solid fa-boxes-stacked icons-nav"></i>Loại sản phẩm
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../admin/SanPham.html" class="nav-link">
                                    <i class="fa-solid fa-barcode icons-nav"></i>Sản phẩm
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../admin/NhaCungCap.html" class="nav-link">
                                    <i class="fa-solid fa-truck icons-nav"></i>Nhà cung cấp
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../admin/KhachHang.html" class="nav-link">
                                    <i class="fa-solid fa-users icons-nav"></i>Khách hàng
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../admin/HoaDonNhap.html" class="nav-link">
                                    <i class="fa-solid fa-file-import icons-nav"></i>Hóa đơn nhập
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../admin/HoaDonBan.html" class="nav-link">
                                    <i class="fa-solid fa-cart-shopping icons-nav"></i>Hóa đơn bán
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="" class="nav-link">
                                    <i class="fa-solid fa-newspaper icons-nav"></i>Tin tức
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="" class="nav-link">
                                    <i class="fa-solid fa-gear icons-nav"></i>Thiết lập
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="grid__col11">
                        <div class="grid__row">
                            <div class="grid__col11-col4">
                                <div class="col4-infoadmin">
                                    <div class="col4-infoadmin-title">
                                        <h3>Nhập thông tin hóa đơn nhập</h3>
                                    </div>
                                    <form action="">
                                        <div class="input">
                                            <label for="">Mã hóa đơn nhập:</label><br>
                                            <input type="text" placeholder="Nhập mã hóa đơn..." id="mahdn">
                                        </div>
                                        <div class="input input-supplier">
                                            <label for="">Nhân viên:</label><br>
                                            <select name="" id="nhanvien">
                                                <option value="">--Chọn nhân viên--</option>
                                                <option value="NhatViet">Nhật Việt</option>
                                                <option value="BảoAnh">Bảo Anh</option>
                                                <option value="NhưNghia">Như Nghĩa</option>
                                            </select>
                                        </div>
                                        <div class="input input-supplier" >
                                            <label for="">Nhà cung cấp:</label><br>
                                            <select name="" id="ncc">
                                                <option value="">--Chọn nhà cung cấp</option>
                                                <option value="Samsung">SamSung</option>
                                                <option value="OPPO">OPPO</option>
                                                <option value="Appel">Appel</option>
                                                <option value="Xiaomi">Xiaomi</option>
                                            </select>
                                        </div>
                                        <div class="input">
                                            <label for="">Mã sản phẩm:</label><br>
                                            <input type="text" placeholder="Mã sản phẩm " id="masp">
                                        </div>
                                        <div class="input">
                                            <label for="">Số lượng:</label><br>
                                            <input type="text" placeholder="0" id="soluong">
                                        </div>
                                        <div class="input">
                                            <label for="">Đơn giá:</label><br>
                                            <input type="text" placeholder="0" id="dongia">
                                        </div>
                                    </form>

                                    
                                    <table class="table_chitiet">
                                        <thead >
                                            <tr>
                                                <th>Mã sản phẩm</th>
                                                <th>Tên sản phẩm</th>
                                                <th>Số lượng</th>
                                                <th>Đơn giá</th>
                                                <th>Thao tác</th>
                                            </tr>
                                        </thead>
                                        <tbody id="DSSanPham">

                                        </tbody>
                                    </table>
                                    

                                    <hr style="margin-top: 20px; margin-bottom: 20px; background: #4B7BE5;">
                                    <div class="btn-product">
                                        <button class="add-product" onclick="ThemHD()">Thêm hóa đơn nhập</button>
                                        <button class="nhap-product" onclick="NhapMoi()">Nhập mới</button>
                                        <button class="update-product" onclick="CapNhap()">Cập nhập thông tin</button>
                                    </div>
                                </div>
                            </div>
                            <div class="grid__col11-col8">
                                <div class="col8-title">
                                    <h3>Danh sách hóa đơn nhập</h3>
                                </div>
                                <div class="col8-info">
                                    <div class="col8-input">
                                        <input type="text" placeholder="Nhập mã hóa đơn nhập" style="width: 70%;padding: 0 10px; height: 40px; margin-top: 10px;">
                                        <button class="btn-search"><i class="fa-solid fa-magnifying-glass" style="margin-right: 5px;"></i>Tìm kiếm</button>
                                    </div>
                                    <!-- <div class="col8-info-list">
                                       
                                        <p style="text-align: center;">Mã HDN</p>
                                        <p style="text-align: center;">Nhân viên</p>
                                        <p style="text-align: center;">Nhà cung cấp</p>
                                        <p style="text-align: center;">Tổng sản phẩm</p>
                                        <p style="text-align: center;">Tổng tiền </p>
                                        <p style="text-align: center;">Ngày tạo</p>
                                        <p style="text-align: center;">Thao tác</p>
                                        
                                    </div> -->
                                    <div class="table" style="margin-top: 10px;">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Mã HDN</th>
                                                    <th>Nhân viên</th>
                                                    <th>Nhà cung cấp</th>
                                                    <th>Mã sản phẩm</th>
                                                    <th>Số lượng</th>
                                                    <th>Đơn giá</th>
                                                    <th>Thao tác</th>
                                                </tr>
                                            </thead>
                                            <tbody id="listproduct"></tbody>
                                                <!-- <tr>
                                                    <td>01</td>
                                                    <td>Điện thoại</td>
                                                    <td>
                                                    <i class="fas fa-trash-alt" title="Xóa"></i>
                                                    </td>
                                                </tr> -->
                                            
                                        </table>
                                    </div>
                                    <div class="col8-info-thongke">
                                        <p style="padding: 20px;">Số lượng hóa đơn nhập: <span id="soluonghd"></span></p>
                                        <p style="padding: 20px;">Tổng tiền: <span id="Tongtien"></span></p>
                                    </div>
                                    <button class="delete" onclick ="XoaChon()">Xóa chọn</button>  
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        var list = JSON.parse(localStorage.getItem('hoadonnhap')) || [];
        var sanpham = JSON.parse(localStorage.getItem('sanpham')) || [];

        function loadsp(){
            var sp = "";
            for(x of sanpham){
                sp +=`<tr>
                        <td>${x.masp}</td>
                        <td>${x.tensp}</td>
                        <td>${x.soluong}</td>
                        <td>${x.giaban}</td>
                        <td>
                            <i class="fas fa-trash-alt" title="Xóa" onclick="Xoa"></i>
                        </td>
                    </tr>`
            }
            document.getElementById('DSSanPham').innerHTML = sp;
        }

        function loadhd(){
            var hd = "";
            var sl = 0;
            var tongtien = 0;
            for(x of list){
                tongtien += x.soluong * x.dongia;
                sl++;
                hd += `<tr>
                            <td>${x.mahd}</td>
                            <td>${x.nhanvien}</td>
                            <td>${x.ncc}</td>
                            <td>${x.soluong}</td>
                            <td>${x.dongia}</td>
                            <td>${x.masp}</td>
                            <td>
                                <i class="fa-solid fa-pen-to-square" title= "Sửa" onclick="SuaHD('${x.mahd}')"></i>
                                <i class="fas fa-trash-alt" title="Xóa" onclick="XoaHD('${x.mahd}')"></i>
                            </td>
                        </tr> `;
            }
            document.getElementById('listproduct').innerHTML = hd;
            document.getElementById('soluonghd').innerHTML = sl;
            document.getElementById('Tongtien').innerHTML = tongtien;
        }

        loadsp();
        loadhd()

        function ThemHD(){
            // alert(0)

            var mahd = document.getElementById('mahdn').value;
            var nhanvien = document.getElementById('nhanvien').value;
            var ncc = document.getElementById('ncc').value;
            var soluong = document.getElementById('soluong').value;
            var dongia = document.getElementById('dongia').value;
            var masp = document.getElementById('masp').value;
            
            if(mahd == null || mahd == ""){
                alert("Vui lòng nhập mã hóa đơn!")
                return false;
            }
            else if(nhanvien == "choose"){
                alert("Vui lòng chọn tên nhân viên!")
                return false;
            }
            else if(ncc == "choose"){
                alert("Vui lòng chọn tên nhà cung cấp")
                return false;
            }
            else if(soluong < 0 || isNaN(soluong)){
                alert("Số lượng không được nhỏ hơn 0")
                return false;
            }
            else if(dongia < 0 || isNaN(dongia)){
                alert("Đơn giá không được nhỏ hơn 0")
                return false;
            }
            for(x of sanpham){
                if(x.masp != masp){
                    alert("Mã sản phẩm không đúng vui lòng chọn lại mã")
                    return false;
                }
            }

            if(list == null) list = [];
            var hdn = {
                'mahd': mahd,
                'nhanvien': nhanvien,
                'ncc': ncc,
                'soluong':soluong,
                'dongia': dongia,
                'masp': masp,
            }
            list.push(hdn);
            localStorage.setItem('hoadonnhap', JSON.stringify(list));
            alert("Thêm thành công");
            location.reload();
        }

        function SuaHD(){
            for(x of list){
                var mahd = document.getElementById('mahdn').value = x.mahd
                var nhanvien = document.getElementById('nhanvien').value = x.nhanvien
                var ncc = document.getElementById('ncc').value =x.ncc
                var soluong = document.getElementById('soluong').value =x.soluong
                var dongia = document.getElementById('dongia').value = x.dongia
                var masp = document.getElementById('masp').value = x.masp;
            }
        }

        function XoaHD(mahd){
            if(confirm("Bạn có đồng ý muốn xóa không!")){
                var index = list.findIndex(function(x){
                    return x.mahd == mahd
                })
                if(index >= 0){
                    list.splice(index, 1)
                }
                localStorage.setItem('hoadonnhap', JSON.stringify(list))
                location.reload()
            }
        }


        function NhapMoi(){
            var mahd = document.getElementById('mahdn').value = ""
            var nhanvien = document.getElementById('nhanvien').value = "choose"
            var ncc = document.getElementById('ncc').value = "choose"
            var soluong = document.getElementById('soluong').value = ""
            var dongia = document.getElementById('dongia').value = ""
            var masp = document.getElementById('masp').value = ""
        }

        function CapNhap(){
            var mahd = document.getElementById('mahdn').value;
            var nhanvien = document.getElementById('nhanvien').value;
            var ncc = document.getElementById('ncc').value;
            var soluong = document.getElementById('soluong').value;
            var dongia = document.getElementById('dongia').value;
            var masp = document.getElementById('masp').value;
            var ok = true;
            
            if(mahd == null || mahd == ""){
                alert("Vui lòng nhập mã hóa đơn!")
                return false;
            }
            else if(nhanvien == "choose"){
                alert("Vui lòng chọn tên nhân viên!")
                return false;
            }
            else if(ncc == "choose"){
                alert("Vui lòng chọn tên nhà cung cấp")
                return false;
            }
            else if(soluong < 0 || isNaN(soluong)){
                alert("Số lượng không được nhỏ hơn 0")
                return false;
            }
            else if(dongia < 0 || isNaN(dongia)){
                alert("Đơn giá không được nhỏ hơn 0")
                return false;
            }

            for(x of list){
                if(x.mahd == mahd){
                    x.nhanvien = nhanvien;
                    x.ncc = ncc;
                    x.soluong = soluong;
                    x.dongia = dongia;
                    x.masp = masp;
                    ok = false;
                    break
                }
                
            }
            if(ok == false){
                alert("Cập nhập thành công!")
                localStorage.setItem("hoadonnhap", JSON.stringify(list))
                location.reload();
            }
            else{
                alert("Cập nhập thất bại")
            }
        }

        function XoaChon(){
            alert("Bạn có muốn xóa không")
            localStorage.setItem("hoadonnhap", null) 
            location.reload();
            
        }

    </script>
</body>
</html>